# US-015: Limitación de unicidad de documento por tipo

## ID
US-015

## Título
Limitación de unicidad de documento por tipo

## Como
Ciudadano que aporta documentación en un trámite

## Quiero
Que se limite a un solo documento por cada tipo de documento cuando así lo indique la configuración

## Para
Cumplir con las restricciones del procedimiento y evitar errores al subir documentos

## Descripción funcional

Cuando la configuración del procedimiento establece que solo se puede aportar un único documento por tipo documental, el sistema debe impedir que el ciudadano añada más de uno, independientemente del método de aportación que utilice.

Esta limitación aplica a todas las variantes de aportación disponibles: desde dispositivo (PC/móvil), desde documentos entregados anteriormente, y desde mis documentos. Si ya existe un documento aportado para un tipo específico (por cualquier vía), el sistema no debe permitir subir más documentos para ese mismo tipo.

El sistema debe consultar la configuración del procedimiento para determinar si existe limitación de unicidad por tipo de documento y aplicar las validaciones correspondientes, mostrando un mensaje claro al ciudadano cuando intente añadir un segundo documento del mismo tipo.

## Flujo principal

1. Ciudadano accede al paso 4 - Documentos de la solicitud
2. Sistema consulta configuración del procedimiento
3. Sistema identifica si existe limitación de unicidad por tipo de documento
4. Ciudadano selecciona tipo de documento y aporta primer documento
5. Sistema registra documento aportado para ese tipo
6. Ciudadano intenta añadir un segundo documento del mismo tipo
7. Sistema detecta que ya existe un documento de ese tipo
8. Sistema impide la acción y muestra mensaje claro al ciudadano
9. Ciudadano solo puede sustituir el documento existente o eliminarlo antes de añadir otro

## Criterios de aceptación

### Escenario 1: Limitación de unicidad configurada

**Dado** un procedimiento con configuración de un único documento por tipo  
**Cuando** el ciudadano intenta aportar un segundo documento del mismo tipo  
**Entonces** el sistema impide añadir el documento  
**Y** muestra un mensaje claro indicando la restricción

### Escenario 2: Limitación aplica desde dispositivo

**Dado** la configuración de un único documento por tipo  
**Y** un documento ya aportado desde dispositivo  
**Cuando** el ciudadano intenta añadir otro desde dispositivo  
**Entonces** el sistema no permite la aportación  
**Y** informa que ya existe un documento de ese tipo

### Escenario 3: Limitación aplica desde documentos entregados anteriormente

**Dado** la configuración de un único documento por tipo  
**Y** un documento ya aportado desde cualquier origen  
**Cuando** el ciudadano intenta añadir otro desde documentos entregados anteriormente  
**Entonces** el sistema no permite seleccionarlo  
**Y** muestra mensaje indicando que ya existe un documento de ese tipo

### Escenario 4: Limitación aplica desde mis documentos

**Dado** la configuración de un único documento por tipo  
**Y** un documento ya aportado desde cualquier origen  
**Cuando** el ciudadano intenta añadir otro desde mis documentos  
**Entonces** el sistema no permite seleccionarlo  
**Y** muestra mensaje indicando que ya existe un documento de ese tipo

### Escenario 5: Sin limitación de unicidad

**Dado** un procedimiento sin configuración de limitación de unicidad  
**Cuando** el ciudadano aporta múltiples documentos del mismo tipo  
**Entonces** el sistema permite añadir todos los documentos  
**Y** no muestra mensajes de restricción

### Escenario 6: Sustitución de documento único

**Dado** la configuración de un único documento por tipo  
**Y** un documento ya aportado  
**Cuando** el ciudadano elimina el documento existente  
**Entonces** el sistema permite aportar un nuevo documento de ese tipo  
**Y** la restricción se mantiene para el nuevo documento

---

*Historia creada: 28/01/2026*  
*Última actualización: 28/01/2026*
