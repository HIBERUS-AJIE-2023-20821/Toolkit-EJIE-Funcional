# US-032: Edición condicional de campos en datos específicos

**Épica:** [EPIC-008](EPIC-008.md) - Subsanación - Proceso del Ciudadano

## Historia de usuario
**Como** ciudadano en subsanación  
**Quiero** editar solo los campos marcados y sus dependientes condicionados  
**Para** corregir los datos requeridos sin alterar el resto de la información

## Descripción funcional
En el paso de datos específicos (idéntico en estructura a la solicitud original), el sistema carga todos los componentes mostrando los no marcados para subsanación en modo solo lectura. Los campos marcados por el tramitador están habilitados para edición.

Cuando el ciudadano modifica un campo condicionante que está marcado para subsanar, el sistema evalúa las reglas de condicionamiento configuradas y habilita automáticamente los campos dependientes que correspondan según el nuevo valor. Solo se activan componentes condicionados si el campo condicionante está marcado como "a subsanar".

El sistema aplica las mismas validaciones de negocio que en la solicitud original:
- Validaciones de formato de datos
- Validaciones de coherencia entre campos
- Validaciones de obligatoriedad según reglas configuradas

El ciudadano puede guardar el progreso en cualquier momento. El sistema guarda automáticamente los cambios como borrador, permitiendo al ciudadano volver posteriormente a continuar. Solo existe un borrador por expediente y usuario.

Al intentar avanzar al siguiente paso, el sistema valida que todos los campos obligatorios marcados para subsanación estén completados correctamente.

## Flujo principal
1. Ciudadano accede al paso de datos específicos
2. Sistema carga componentes con campos no marcados en solo lectura
3. Sistema habilita campos marcados para subsanación
4. Ciudadano modifica un campo marcado
5. Sistema valida el valor introducido
6. Si el campo es condicionante, sistema evalúa reglas de condicionamiento
7. Sistema habilita campos dependientes según nueva condición
8. Ciudadano completa campos habilitados
9. Sistema valida obligatorios antes de permitir avanzar

## Criterios de aceptación

### Escenario 1: Campos no marcados en solo lectura

**Dado** que el ciudadano accede al paso de datos específicos  
**Cuando** visualiza los campos  
**Entonces** los campos no marcados se muestran en solo lectura  
**Y** no permite editarlos  
**Y** mantienen los valores originales

### Escenario 2: Edición de campo marcado

**Dado** que un campo está marcado para subsanación  
**Cuando** el ciudadano lo edita  
**Entonces** el sistema permite introducir nuevo valor  
**Y** aplica validaciones de formato  
**Y** guarda el cambio

### Escenario 3: Habilitación de campos dependientes

**Dado** que el ciudadano modifica un campo condicionante marcado  
**Cuando** el sistema evalúa las reglas  
**Entonces** el sistema habilita campos dependientes según nueva condición  
**Y** los campos dependientes se vuelven editables  
**Y** se aplican las reglas de obligatoriedad correspondientes

### Escenario 4: Validación de campos obligatorios

**Dado** que hay campos obligatorios marcados sin completar  
**Cuando** el ciudadano intenta avanzar  
**Entonces** el sistema bloquea el avance  
**Y** muestra mensajes indicando campos faltantes  
**Y** resalta visualmente los campos pendientes

### Escenario 5: Validaciones de negocio en campos editables

**Dado** que el ciudadano introduce datos en campo marcado  
**Cuando** el valor no cumple validaciones de negocio  
**Entonces** el sistema muestra mensaje de validación  
**Y** indica cómo corregir el error  
**Y** no permite continuar con valor inválido

### Escenario 6: Guardado de progreso

**Dado** que el ciudadano modifica campos  
**Cuando** solicita guardar  
**Entonces** el sistema guarda cambios realizados  
**Y** mantiene estado de campos habilitados  
**Y** permite continuar posteriormente

### Escenario 6: Guardado de progreso como borrador

**Dado** que el ciudadano modifica campos  
**Cuando** el sistema guarda automáticamente  
**Entonces** el sistema guarda cambios como borrador  
**Y** solo existe un borrador por expediente y usuario  
**Y** el ciudadano puede volver posteriormente a continuar  
**Y** al acceder nuevamente, el sistema recupera el borrador

### Escenario 7: Deshabilitación de dependientes por cambio

**Dado** que un campo dependiente estaba habilitado  
**Cuando** se modifica el condicionante y ya no cumple la condición  
**Entonces** el sistema deshabilita el campo dependiente  
**Y** puede limpiar su valor si aplica según reglas  
**Y** ajusta obligatoriedad

---

*Historia creada: 29/01/2026*
