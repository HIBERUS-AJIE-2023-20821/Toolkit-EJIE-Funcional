# US-030: Acceso a subsanación desde Mi Carpeta

**Épica:** [EPIC-008](EPIC-008.md) - Subsanación - Proceso del Ciudadano

## Historia de usuario
**Como** ciudadano que ha recibido un requerimiento de subsanación  
**Quiero** acceder al proceso de subsanación desde Mi Carpeta  
**Para** iniciar la corrección de los datos y documentos señalados

## Descripción funcional
Cuando el ciudadano recibe una notificación de requerimiento de subsanación, se activa el botón "Subsanar" en Mi Carpeta. Al pulsarlo, se inicia el acceso al sistema mediante el proceso de apilamiento remoto.

Mi Carpeta envía dos archivos XML con rutas PIF que contienen todos los parámetros necesarios para contextualizar la acción telemática de subsanación:
- Identificador del procedimiento
- Tipo de acción telemática (subsanación)
- Identificador del expediente
- Datos de los interesados
- Otros parámetros de contexto necesarios

El sistema extrae estos parámetros de los archivos XML recibidos y contextualiza correctamente la subsanación, recuperando el borrador generado por el tramitador y presentando al ciudadano todos los pasos del formulario con las marcas de subsanación aplicadas.

## Flujo principal
1. Ciudadano recibe notificación de requerimiento de subsanación
2. Ciudadano accede a Mi Carpeta dentro del plazo establecido
3. Sistema muestra botón "Subsanar" activo para el expediente requerido
4. Ciudadano pulsa botón "Subsanar"
5. Mi Carpeta invoca sistema mediante apilamiento remoto
6. Sistema recibe rutas PIF de archivos XML con parámetros
7. Sistema extrae parámetros de los XML
8. Sistema identifica procedimiento, expediente y acción telemática
9. Sistema comprueba existencia de borrador anterior para este expediente y usuario
10. Si existe borrador, sistema lo recupera para permitir continuar
11. Si no existe borrador, sistema recupera borrador de subsanación inicial del tramitador
12. Sistema presenta formulario de subsanación al ciudadano

## Criterios de aceptación

### Escenario 1: Activación de botón subsanar tras notificación

**Dado** que el ciudadano ha recibido notificación de requerimiento  
**Cuando** accede a Mi Carpeta  
**Entonces** el sistema muestra el botón "Subsanar" activo  
**Y** el botón está asociado al expediente correspondiente

### Escenario 2: Invocación mediante apilamiento remoto

**Dado** que el ciudadano pulsa "Subsanar"  
**Cuando** Mi Carpeta invoca el sistema  
**Entonces** el sistema recibe rutas PIF de dos archivos XML  
**Y** los archivos contienen los parámetros de contextualización

### Escenario 3: Extracción de parámetros de XML

**Dado** que el sistema recibe los archivos XML  
**Cuando** procesa los parámetros  
**Entonces** el sistema extrae procedimiento, acción telemática, expediente e interesados  
**Y** valida que todos los parámetros obligatorios están presentes

### Escenario 4: Recuperación del borrador de subsanación

**Dado** que el sistema tiene los parámetros extraídos  
**Cuando** identifica el expediente  
**Entonces** el sistema recupera el borrador de subsanación generado por el tramitador  
**Y** carga toda la información de la solicitud original

### Escenario 5: Presentación de formulario contextualizado

**Dado** que el borrador se ha recuperado correctamente  
**Cuando** el sistema prepara la presentación  
**Entonces** el sistema muestra todos los pasos del formulario  
**Y** indica visualmente qué elementos deben subsanarse  
**Y** el ciudadano puede iniciar el proceso de corrección

### Escenario 6: Gestión de errores en acceso

**Dado** que se produce un error al acceder  
**Cuando** los parámetros son inválidos o el borrador no existe  
**Entonces** el sistema muestra mensaje de error descriptivo  
**Y** no permite continuar con la subsanación  
**Y** registra el error para análisis

### Escenario 7: Recuperación de borrador en progreso

**Dado** que existe un borrador de subsanación previo del usuario  
**Cuando** el ciudadano accede desde Mi Carpeta  
**Entonces** el sistema recupera el borrador existente  
**Y** permite continuar desde donde lo dejó  
**Y** mantiene los cambios realizados anteriormente

### Escenario 8: Borrador único por expediente y usuario

**Dado** que el sistema gestiona borradores  
**Cuando** verifica existencia de borradores  
**Entonces** solo puede existir un borrador por expediente y usuario  
**Y** el borrador se reutiliza en accesos posteriores  
**Y** se mantiene hasta la presentación final

### Escenario 9: Acceso fuera de plazo

**Dado** que el plazo de subsanación ha vencido  
**Cuando** el ciudadano intenta acceder  
**Entonces** Mi Carpeta no muestra el botón "Subsanar"  
**Y** el ciudadano no puede continuar con el requerimiento

---

*Historia creada: 29/01/2026*
