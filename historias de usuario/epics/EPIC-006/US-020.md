# US-020: Sincronización y validación de controles

**Épica:** [EPIC-006](EPIC-006.md) - Autorizaciones de consulta de datos

## Historia de usuario
**Como** sistema  
**Quiero** sincronizar automáticamente los controles de autorización según las selecciones del ciudadano  
**Para** garantizar coherencia entre la pregunta global, switches y checkboxes, y permitir avanzar solo cuando sea válido

## Descripción funcional
El paso de autorizaciones incluye tres niveles de controles interrelacionados:
1. **Pregunta global** (radiobutton Sí/No)
2. **Switches generales** por bloque (uno para "salvo oposición", otro para "únicamente si consiente")
3. **Checkboxes individuales** por cada dato

El sistema debe mantener sincronización automática entre estos tres niveles:
- Cambios en la pregunta global afectan a switches y checkboxes
- Cambios en switches afectan a checkboxes
- Cambios en checkboxes pueden afectar a switches y pregunta global

Además, el sistema debe validar que el ciudadano haya tomado la decisión inicial (pregunta global) antes de permitir continuar al siguiente paso.

## Criterios de aceptación

### CA-1: Sincronización pregunta global → switches y checkboxes
**Dado** que el ciudadano cambia la respuesta de la pregunta global  
**Cuando** selecciona Sí o No  
**Entonces** el sistema debe:
- Actualizar todos los switches según corresponda
- Actualizar todos los checkboxes según corresponda
- Mantener coherencia en toda la pantalla

### CA-2: Sincronización switch → checkboxes
**Dado** que el ciudadano activa o desactiva un switch general  
**Cuando** cambia su estado  
**Entonces** el sistema debe marcar o desmarcar TODOS los checkboxes del bloque correspondiente

### CA-3: Sincronización checkboxes → switch
**Dado** que el ciudadano modifica checkboxes individuales  
**Cuando** todos los checkboxes de un bloque quedan en el mismo estado  
**Entonces** el switch general debe reflejar ese estado (activado si todos marcados, desactivado si todos desmarcados)

### CA-4: Sincronización parcial checkboxes → switch
**Dado** que algunos checkboxes están marcados y otros no en un mismo bloque  
**Cuando** el ciudadano los modifica  
**Entonces** el switch debe mostrar estado indeterminado o desactivado

### CA-5: Sincronización checkboxes → pregunta global
**Dado** que el ciudadano modifica checkboxes individuales  
**Cuando** todos los checkboxes de ambos bloques reflejan una respuesta coherente (todos "Sí" o todos "No")  
**Entonces** la pregunta global debe actualizarse al valor correspondiente

### CA-6: Sincronización parcial → pregunta global
**Dado** que hay combinación mixta de checkboxes marcados/desmarcados  
**Cuando** el ciudadano los modifica  
**Entonces** la pregunta global debe mantener la última selección o mostrar estado indeterminado

### CA-7: Validación de pregunta global obligatoria
**Dado** que el ciudadano no ha respondido la pregunta global  
**Cuando** intenta continuar al siguiente paso  
**Entonces** el sistema debe:
- Impedir el avance
- Mostrar mensaje de validación: "Debes responder si autorizas la consulta de datos"
- Resaltar la pregunta global

### CA-8: Permitir continuar con decisión tomada
**Dado** que el ciudadano ha respondido la pregunta global  
**Cuando** intenta continuar al siguiente paso  
**Entonces** el sistema debe permitir el avance independientemente de su respuesta (Sí o No)

### CA-9: Registro completo de decisiones
**Dado** que el ciudadano completa el paso de autorizaciones  
**Cuando** avanza al siguiente paso  
**Entonces** el sistema debe registrar:
- Respuesta a pregunta global
- Estado de cada checkbox individual
- Timestamp de cada cambio realizado

### CA-10: Impacto en paso de documentos
**Dado** que el ciudadano finalizó el paso de autorizaciones  
**Cuando** accede al paso de documentos  
**Entonces** los documentos relacionados con datos no autorizados u opuestos deben aparecer como obligatorios
