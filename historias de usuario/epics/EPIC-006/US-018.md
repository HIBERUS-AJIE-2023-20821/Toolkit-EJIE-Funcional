# US-018: Gestión de autorización selectiva de datos

**Épica:** [EPIC-006](EPIC-006.md) - Autorizaciones de consulta de datos

## Historia de usuario
**Como** ciudadano  
**Quiero** autorizar selectivamente la consulta de datos que requieren mi consentimiento expreso  
**Para** controlar el acceso a mi información sensible y decidir qué aporto yo mismo

## Descripción funcional
El **Bloque "Datos únicamente si consiente"** permite al ciudadano gestionar la autorización de datos que requieren su consentimiento expreso. El bloque incluye:

- Un **switch general** que marca/desmarca todos los checkboxes del bloque
- Un **checkbox individual** por cada dato que requiere autorización expresa
- **Comportamiento**: Si el checkbox está marcado → el ciudadano AUTORIZA la consulta de ese dato
- Si el checkbox está desmarcado → el ciudadano NO autoriza (debe aportar documento)

El ciudadano puede:
1. Usar el switch general para autorizar todos o ninguno
2. Marcar/desmarcar checkboxes individuales para ajustar su decisión
3. Ver claramente qué datos deberá aportar si no autoriza

Si no autoriza algún dato, los documentos relacionados aparecerán como obligatorios en el Paso 4.

## Criterios de aceptación

### CA-1: Switch general del bloque
**Dado** que el bloque "Datos únicamente si consiente" está habilitado  
**Cuando** el ciudadano activa el switch general  
**Entonces** el sistema debe marcar TODOS los checkboxes del bloque (autoriza todos)

### CA-2: Desactivar switch general
**Dado** que el switch general está activado  
**Cuando** el ciudadano lo desactiva  
**Entonces** el sistema debe desmarcar TODOS los checkboxes del bloque (no autoriza ninguno)

### CA-3: Autorización selectiva individual
**Dado** que el bloque está habilitado  
**Cuando** el ciudadano marca un checkbox individual  
**Entonces** el sistema debe registrar que autoriza la consulta de ese dato específico

### CA-4: No autorización individual
**Dado** que el bloque está habilitado  
**Cuando** el ciudadano desmarca un checkbox individual  
**Entonces** el sistema debe:
- Registrar que NO autoriza la consulta de ese dato
- Mostrar mensaje informativo indicando que deberá aportar documentación relacionada

### CA-5: Sincronización del switch general
**Dado** que el ciudadano modifica checkboxes individuales  
**Cuando** todos los checkboxes quedan marcados  
**Entonces** el switch general debe activarse automáticamente

### CA-6: Desincronización del switch general
**Dado** que el switch general está activado  
**Cuando** el ciudadano desmarca al menos un checkbox individual  
**Entonces** el switch general debe desactivarse automáticamente

### CA-7: Mensaje informativo
**Dado** que el ciudadano desmarca autorización de algún dato  
**Cuando** desmarca el checkbox  
**Entonces** debe visualizar un mensaje informativo: "Deberás aportar la documentación cuya consulta no autorices"

### CA-8: Registro de autorizaciones
**Dado** que el ciudadano ha gestionado las autorizaciones  
**Cuando** continúa con la tramitación  
**Entonces** el sistema debe registrar para cada dato si está autorizado o no

### CA-9: Documentación obligatoria
**Dado** que el ciudadano no autorizó la consulta de uno o más datos  
**Cuando** accede al paso de documentos  
**Entonces** los documentos relacionados con esos datos deben aparecer como obligatorios
