# US-027: Guardado de solicitud presencial y asignación de código

**Épica:** [EPIC-007](EPIC-007.md) - Presencial Ciudadanía - Proceso del Ciudadano

## Historia de usuario
**Como** ciudadano que completa una solicitud presencial  
**Quiero** guardar mi información con un código único  
**Para** poder recuperarla posteriormente cuando me presente ante el tramitador

## Descripción funcional
En el último paso del formulario presencial, el sistema no ofrece la opción de firmar y enviar la solicitud, ya que no es posible sin autenticación. En su lugar, presenta una opción de "Guardar" que finaliza el proceso del ciudadano.

Al guardar, el sistema:
- Asigna un código único de solicitud presencial
- Persiste todos los datos y documentos introducidos
- Finaliza la solicitud para presentación presencial
- Genera un identificador único que será utilizado para la recuperación posterior por el tramitador

El código de solicitud presencial se forma combinando información del procedimiento y un identificador único de solicitud. Este código es permanente y permite al tramitador recuperar la información exacta que el ciudadano introdujo.

La solicitud presencial queda almacenada en el sistema hasta que un tramitador la recupere y complete el proceso de presentación. El ciudadano no puede volver a acceder a la solicitud una vez finalizada. La información permanece en el sistema exclusivamente para uso del tramitador que completará el proceso presencial.

## Flujo principal
1. Ciudadano completa los pasos del formulario presencial
2. Ciudadano accede al paso final
3. Sistema muestra opción "Guardar" en lugar de "Firmar y enviar"
4. Ciudadano confirma guardado
5. Sistema valida que datos mínimos obligatorios estén completos
6. Sistema genera código único de solicitud presencial
7. Sistema finaliza la solicitud para presentación presencial
8. Sistema persiste todos los datos y documentos
9. Sistema muestra confirmación con código asignado

## Criterios de aceptación

### Escenario 1: Guardado de solicitud presencial en paso final

**Dado** que el ciudadano está en el paso final del formulario presencial  
**Cuando** visualiza las opciones disponibles  
**Entonces** el sistema muestra "Guardar"  
**Y** no muestra opción de "Firmar y enviar"  
**Y** no muestra opción de "Enviar sin firmar"

### Escenario 2: Asignación de código único

**Dado** que el ciudadano confirma guardar  
**Cuando** el sistema procesa la solicitud  
**Entonces** el sistema genera un código único de solicitud presencial  
**Y** el código incluye identificador del procedimiento  
**Y** el código incluye dígitos de Platea  
**Y** el código incluye identificador único de solicitud

### Escenario 3: Finalización de solicitud presencial

**Dado** que el guardado se completa  
**Cuando** el sistema asigna el código  
**Entonces** la solicitud queda finalizada para presentación presencial  
**Y** queda disponible para recuperación por el tramitador  
**Y** se puede identificar por su código único

### Escenario 4: Persistencia de datos y documentos

**Dado** que se guarda la solicitud presencial  
**Cuando** el sistema confirma el guardado  
**Entonces** todos los datos introducidos se persisten  
**Y** todos los documentos cargados se mantienen asociados  
**Y** las autorizaciones y declaraciones se registran  
**Y** la información queda lista para recuperación

### Escenario 5: Validación de datos mínimos

**Dado** que el ciudadano intenta guardar  
**Cuando** accede al paso final  
**Entonces** el sistema valida que cada paso obligatorio esté completado  
**Y** cada paso controla qué datos son obligatorios  
**Y** el sistema impide finalizar si faltan datos obligatorios en cualquier paso

### Escenario 6: Confirmación de guardado exitoso

**Dado** que la solicitud presencial se guarda correctamente  
**Cuando** el sistema completa el proceso  
**Entonces** el sistema muestra mensaje de confirmación  
**Y** presenta el código de solicitud presencial generado  
**Y** indica los siguientes pasos a seguir

---

*Historia creada: 29/01/2026*
