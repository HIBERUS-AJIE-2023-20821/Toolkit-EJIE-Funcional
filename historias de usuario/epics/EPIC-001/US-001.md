# US-001: Acceso al proceso de subsanación e identificación del requerimiento

## ID
US-001

## Título
Acceso al proceso de subsanación e identificación del requerimiento

## Como
Ciudadano o representante (con apoderamiento RdA o representación específica)

## Quiero
Acceder al proceso de subsanación mediante enlace directo y visualizar el requerimiento

## Para
Poder responder al requerimiento de documentación o datos solicitados por la Administración

## Descripción funcional

El ciudadano (o su representante, que puede tener apoderamiento registrado en RdA o representación específica establecida en la solicitud inicial) accede al Orquestador mediante enlace recibido en notificación para responder a un requerimiento de subsanación. El sistema debe autenticar al usuario, consultar configuración del procedimiento en CCP, obtener formulario desde EraiKIT, verificar permisos sobre el expediente, identificar el tipo de actuación (interesado, representante RdA, representante específico, autorizado empresa), verificar si existe borrador previo y renderizar el formulario con los campos/documentos a subsanar.

## Flujo principal

1. Usuario hace clic en enlace de notificación con parámetros (expediente ID, procedimiento ID, acción)
2. Sistema redirige a XLNET para autenticación
3. Sistema consulta CCP para configuración del procedimiento y formulario asociado
4. Sistema consulta EraiKIT para obtener formulario (versión específica)
5. Sistema identifica tipo de actuación: interesado, representante RdA, representante específico o autorizado empresa
6. Sistema verifica permisos del usuario sobre el expediente
7. Sistema consulta si existe borrador previo y ofrece opción de continuar o empezar de nuevo
8. Sistema renderiza formulario mostrando campos/documentos requeridos

## Criterios de aceptación

### Escenario 1: Acceso exitoso con identificación de tipo de actuación

**Dado** un ciudadano autenticado con expediente y requerimiento de subsanación pendiente  
**Cuando** accede mediante enlace válido  
**Entonces** el sistema consulta CCP y EraiKIT  
**Y** identifica el tipo de actuación: interesado principal, representante RdA, representante específico o autorizado  
**Y** muestra mensaje indicando rol (ej: "Actuando como: Representante específico de Juan Martínez")  
**Y** renderiza el formulario con campos/documentos a subsanar

### Escenario 2: Acceso con borrador previo guardado

**Dado** un ciudadano con borrador guardado previamente  
**Cuando** accede al proceso de subsanación  
**Entonces** el sistema muestra mensaje "Tienes un borrador guardado el [fecha]. ¿Deseas continuar con él?"  
**Y** ofrece opciones "Continuar con borrador" y "Empezar de nuevo"  
**Y** carga datos guardados si selecciona continuar o descarta borrador si elige empezar de nuevo

### Escenario 3: Usuario sin permisos sobre el expediente

**Dado** un ciudadano que NO es interesado ni representante del expediente  
**Cuando** intenta acceder al enlace de subsanación  
**Entonces** el sistema muestra error "No tienes permisos para acceder a esta subsanación"  
**Y** NO permite continuar  
**Y** registra el intento no autorizado en auditoría

### Escenario 4: Apoderamiento RdA revocado o vencido

**Dado** un representante con apoderamiento revocado en RdA  
**Cuando** intenta acceder al enlace de subsanación  
**Entonces** el sistema consulta RdA y detecta que el apoderamiento no es válido  
**Y** muestra error "Tu apoderamiento ha sido revocado o ha vencido"  
**Y** NO permite continuar

### Escenario 5: Parámetros inválidos o error en sistemas integrados

**Dado** un enlace con parámetros incorrectos o error al consultar CCP/EraiKIT  
**Cuando** el usuario intenta acceder  
**Entonces** el sistema reintenta hasta 3 veces si es error de sistema  
**Y** muestra error descriptivo indicando el problema  
**Y** registra el error en logs técnicos  
**Y** NO permite continuar hasta resolver el problema

---

*Historia creada: 26/01/2026*  
*Última actualización: 26/01/2026*


