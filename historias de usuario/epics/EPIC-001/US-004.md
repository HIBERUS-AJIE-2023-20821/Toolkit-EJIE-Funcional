# US-004: Gestión de documentos requeridos para subsanación

## ID
US-004

## Título
Gestión de documentos requeridos para subsanación

## Como
Ciudadano o representante

## Quiero
Cargar, visualizar y eliminar documentos requeridos con validaciones de formato y tamaño

## Para
Aportar la documentación solicitada y completar el requerimiento de subsanación

## Descripción funcional

El ciudadano debe poder cargar los documentos marcados como requeridos para la subsanación según la configuración de tipos de documento establecida en CCP. El sistema debe validar formato (PDF, JPG, PNG, etc.) y tamaño máximo, almacenar en Dokusi, mostrar lista de documentos cargados con detalles, permitir descarga y eliminación antes del envío, diferenciar entre obligatorios y opcionales, y bloquear el avance si faltan documentos obligatorios.

## Flujo principal

1. Sistema muestra lista de tipos de documentos requeridos desde configuración CCP
2. Sistema diferencia visualmente entre obligatorios y opcionales
3. Ciudadano selecciona archivo desde explorador o arrastra (drag & drop)
4. Sistema valida formato y tamaño máximo
5. Sistema sube archivo a Dokusi y obtiene identificador único
6. Sistema muestra documento en lista con nombre, tamaño y fecha de carga
7. Ciudadano puede descargar, eliminar o añadir más documentos
8. Al hacer clic en "Guardar y continuar", sistema verifica documentos obligatorios
9. Si falta alguno obligatorio, bloquea avance; si todo correcto, guarda referencias y avanza

## Criterios de aceptación

### Escenario 1: Carga exitosa con validaciones

**Dado** un tipo de documento obligatorio configurado en CCP con formatos permitidos (PDF, JPG, PNG) y límite 10 MB  
**Cuando** el ciudadano carga archivo válido mediante selección o drag & drop  
**Entonces** el sistema valida formato y tamaño  
**Y** sube el archivo a Dokusi y obtiene identificador único  
**Y** muestra el documento en lista con: nombre, tamaño y fecha de carga  
**Y** proporciona botones "Descargar" y "Eliminar"

### Escenario 2: Errores de validación

**Dado** un tipo de documento con restricciones  
**Cuando** el ciudadano intenta cargar archivo con formato no permitido  
**Entonces** el sistema muestra error "Formato no permitido. Solo se aceptan: PDF, JPG, PNG"  
**Y** NO sube el archivo  
**Cuando** el ciudadano intenta cargar archivo mayor a 10 MB  
**Entonces** muestra error "El archivo excede el tamaño máximo de 10 MB"

### Escenario 3: Gestión de documentos cargados

**Dado** un documento cargado correctamente  
**Cuando** el ciudadano hace clic en "Descargar"  
**Entonces** el sistema recupera el documento desde Dokusi e inicia descarga  
**Cuando** el ciudadano hace clic en "Eliminar"  
**Entonces** el sistema muestra confirmación "¿Estás seguro de eliminar este documento?"  
**Y** si confirma, elimina la referencia, actualiza la lista y registra en auditoría

### Escenario 4: Control de obligatoriedad

**Dado** 2 tipos de documentos obligatorios y 1 opcional  
**Cuando** el ciudadano NO carga un documento obligatorio e intenta avanzar  
**Entonces** el sistema muestra error "Falta documento obligatorio: [nombre]"  
**Y** marca el tipo en rojo y bloquea el avance  
**Cuando** el ciudadano NO carga el documento opcional pero sí los obligatorios  
**Entonces** el sistema permite avanzar sin error

### Escenario 5: Errores técnicos y guardado en borrador

**Dado** un archivo válido  
**Cuando** Dokusi no responde tras 3 reintentos  
**Entonces** el sistema muestra error "No se pudo cargar el documento. Inténtalo de nuevo"  
**Y** registra el error en logs  
**Y** NO añade el documento a la lista  
**Dado** documentos cargados correctamente  
**Cuando** el ciudadano guarda borrador  
**Entonces** las referencias se mantienen y al regresar los documentos están disponibles sin volver a cargarlos

---

*Historia creada: 26/01/2026*  
*Última actualización: 26/01/2026*
