# US-005: Gestión de declaraciones responsables

## ID
US-005

## Título
Gestión de declaraciones responsables

## Como
Ciudadano o representante

## Quiero
Visualizar, leer y aceptar las declaraciones responsables requeridas

## Para
Cumplir con los requisitos legales del procedimiento y completar la subsanación

## Descripción funcional

El ciudadano debe poder visualizar las declaraciones responsables configuradas en CCP, leer el contenido completo, marcar su aceptación mediante checkbox y cumplir con la obligatoriedad de las declaraciones requeridas. El sistema debe diferenciar entre obligatorias y opcionales, registrar fecha/hora/IP de cada aceptación para auditoría, permitir desmarcar solo las opcionales, bloquear avance si faltan obligatorias y guardar estado en borrador.

## Flujo principal

1. Sistema consulta CCP para obtener declaraciones configuradas (obligatorias y opcionales)
2. Sistema renderiza sección "Declaraciones responsables" con checkboxes desactivados por defecto
3. Ciudadano lee contenido de cada declaración
4. Ciudadano marca checkbox para aceptar declaración
5. Sistema registra fecha/hora/IP de aceptación en auditoría
6. Ciudadano puede desmarcar declaración opcional pero NO obligatoria una vez aceptada
7. Al hacer clic en "Guardar y continuar", sistema verifica que todas las obligatorias están aceptadas
8. Si falta alguna obligatoria, bloquea avance; si todo correcto, guarda y avanza

## Criterios de aceptación

### Escenario 1: Visualización y aceptación de declaraciones

**Dado** una declaración obligatoria y una opcional  
**Cuando** el ciudadano accede a la sección  
**Entonces** el sistema muestra cada declaración con:  
**Y** Etiqueta "Obligatoria" (asterisco rojo *) u "Opcional" claramente diferenciada  
**Y** Checkbox desactivado por defecto  
**Y** Texto completo legible de la declaración  
**Cuando** el ciudadano marca un checkbox  
**Entonces** el sistema registra en auditoría: declaración, fecha/hora, IP y usuario

### Escenario 2: Control de obligatoriedad

**Dado** 2 declaraciones obligatorias y 1 opcional  
**Cuando** el ciudadano acepta solo 1 obligatoria y NO acepta la otra obligatoria ni la opcional  
**Y** hace clic en "Guardar y continuar"  
**Entonces** el sistema muestra error "Debes aceptar todas las declaraciones obligatorias"  
**Y** destaca en rojo la declaración no aceptada y bloquea el avance  
**Cuando** el ciudadano acepta ambas obligatorias (con o sin la opcional)  
**Entonces** el sistema permite avanzar sin error

### Escenario 3: Inmutabilidad de declaraciones obligatorias

**Dado** una declaración obligatoria previamente aceptada  
**Cuando** el ciudadano intenta desmarcar el checkbox  
**Entonces** el sistema bloquea la acción  
**Y** muestra mensaje "Las declaraciones obligatorias no pueden desmarcarse una vez aceptadas"  
**Dado** una declaración opcional aceptada  
**Cuando** el ciudadano desmarca el checkbox  
**Entonces** el sistema actualiza el estado y registra la revocación en auditoría

### Escenario 4: Guardado en borrador y sin declaraciones configuradas

**Dado** un ciudadano que ha aceptado declaraciones  
**Cuando** guarda borrador y vuelve más tarde  
**Entonces** las declaraciones aceptadas permanecen marcadas  
**Dado** un procedimiento sin declaraciones configuradas en CCP  
**Cuando** el ciudadano accede a esta sección  
**Entonces** el sistema muestra mensaje "No hay declaraciones requeridas" o NO muestra la sección  
**Y** permite avanzar directamente al siguiente paso

---

*Historia creada: 26/01/2026*  
*Última actualización: 26/01/2026*
